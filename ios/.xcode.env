# This `.xcode.env` file is versioned and is used to source the environment
# used when running script phases inside Xcode.
# To customize your local environment, create `.xcode.env.local` (not versioned).

# Xcode does not load your shell profile, so Node may not be in PATH.
# We try common ways to get a valid node binary.

# 1) NVM: load nvm so `command -v node` works
if [ -s "$HOME/.nvm/nvm.sh" ]; then
  export NVM_DIR="$HOME/.nvm"
  . "$NVM_DIR/nvm.sh" --no-use
  nvm use default 2>/dev/null || true
elif [ -n "$(command -v brew)" ] && [ -s "$(brew --prefix nvm 2>/dev/null)/nvm.sh" ]; then
  . "$(brew --prefix nvm)/nvm.sh" --no-use
  nvm use default 2>/dev/null || true
fi

# 2) Homebrew: ensure Homebrew node is on PATH (Apple Silicon + Intel)
if [ -d /opt/homebrew/bin ]; then
  export PATH="/opt/homebrew/bin:$PATH"
fi
if [ -d /usr/local/bin ]; then
  export PATH="/usr/local/bin:$PATH"
fi

# 3) Volta / FNM / system node
if [ -x "$HOME/.volta/bin/node" ]; then
  export PATH="$HOME/.volta/bin:$PATH"
fi
if [ -x "$HOME/.fnm/fnm" ]; then
  eval "$("$HOME/.fnm/fnm" env)" 2>/dev/null || true
fi

# Set NODE_BINARY for React Native bundle script
if [ -z "$NODE_BINARY" ]; then
  NODE_BINARY=$(command -v node)
fi
if [ -n "$NODE_BINARY" ]; then
  export NODE_BINARY
else
  # Fallback: common absolute paths (Homebrew Apple Silicon / Intel)
  if [ -x /opt/homebrew/bin/node ]; then
    export NODE_BINARY=/opt/homebrew/bin/node
  elif [ -x /usr/local/bin/node ]; then
    export NODE_BINARY=/usr/local/bin/node
  fi
fi
